{% extends "main/layout.html" %}
{% block content%}
<header class="container page-header text-center">
    
        <h1>ISA - {{ _('Campaigns') }}</h1>
 <hr>
    <p>{{ _('On this page are the curated campaigns that are currently running as part of the ISA tool.')}} {{ _('Click on the name of a campaign to get started and add structured data to an image.') }} {{ _('You can access information on the previous Campaigns in the Archive section.') }}</p>
    
      {% if username != 'Guest' and username != False and username != None %}
    <a href="{{url_for( 'campaigns.CreateCampaign' )}}" class="btn btn-primary">{{ _('Create a new campaign using this tool') }}</a>       
    {% endif %}
</header>
<div class="container">
    <section id="campaigns">
        <div class="section-header">
            <h3>{{ _('Ongoing Campaigns') }}</h3>
        </div>
        <br>
        <table id="campaign_table" class="display table table-bordered" style="width: 100%">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">{{ _('Campaign') }}</th>
                    <th scope="col">{{ _('Images') }}</th>
                    <th scope="col">{{ _('Participants') }}</th>
                    <th scope="col">{{ _('Contributions') }}</th>
                    <th scope="col">{{ _('Start Date') }}</th>
                    <th scope="col">{{ _('End Date') }}</th>
                    <th scope="col">{{ _('Creation Date') }}</th>
                    <th scope="col">{{ _('Status') }}</th>
                    <!-- The next column is hidden and used only for filtering --> 
                    <!-- It stores 1 or 0 to determine open status, so does not depend on UI language -->
                    <th scope="col"></th>
                    <th scope="col">{{ _('Get Started') }}</th>
                </tr>
            </thead>
            <tbody>
            {% for campaign in campaigns %}
                <tr>
                    <td><span class="">{{ campaign.campaign_name }}</span></td>
                    <td>{{ campaign.campaign_images }}</td>
                    <td>{{ campaign.campaign_participants }}</td>
                    <td>{{ campaign.campaign_contributions }}</td>
                    <td><span class="">{{ campaign.start_date.strftime("%d-%m-%y") }}</span></td>
                    <td><span class="">{{ campaign.end_date.strftime("%d-%m-%y") }}</span></td>
                    <td><span class="">{{ campaign.creation_date.strftime("%d-%m-%y") }}</span></td>
                    
                    <!-- Add status and boolean hidden columns depending on end date -->
                    {% if campaign.end_date.strftime("%y-%m-%d") < datetime.now().date().strftime("%y-%m-%d") %}
                        <td><span class=""> {{ _('Closed') }} </span></td>
                        <td>0</td>
                    {% else %}
                        <td><span class="">{{ _('Open') }}</span></td>
                        <td>1</td>
                    {%  endif %}
                    
                    <td><a href="{{url_for('campaigns.getCampaignById', id=campaign.id) }}">{{ _('Go to Campaign') }}</a></td>
                </tr>
            {% endfor%}
            </tbody>
        </table>
    </section>
</div>
<div class="container text-center">


</div>
{% endblock content%}

{% block scripts %} 
<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/b-1.5.6/r-2.2.2/datatables.min.js"></script>
<script src="{{url_for('static', filename='js/campaign-directory.js')}}"></script> 
{% endblock scripts%}